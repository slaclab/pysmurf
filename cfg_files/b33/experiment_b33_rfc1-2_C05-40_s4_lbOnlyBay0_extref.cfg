{
# Based off c02 cfg experiment_b33_lbOnlyBay0_newamps.cfg ; comparing to https://github.com/simonsobs/ocs-site-configs/blob/d617b6590d1c22d3250fa21b2a92eb1412e71d70/ucsd/sat1/smurf-srv20/pysmurf_configs/P10R1/P10R1_C05-XX_s3_extref.cfg
"epics_root" : "test_epics",
"init": {

	"dspEnable": 1,

	"band_0" : {
		"iq_swap_in" : 0,
		"iq_swap_out" : 0,
		"refPhaseDelay" : 6,
		"refPhaseDelayFine" : 16,
		"trigRstDly" : 15, # 0xF
		"feedbackEnable": 1,
		"feedbackGain" : 2048,
		"feedbackPolarity" : 1,
		"feedbackLimitkHz": 225,
		"lmsGain": 1,
		"att_uc": 24,
		"att_dc": 0,
		"amplitude_scale": 12
	},

	"band_1" : {
		"iq_swap_in" : 0,
		"iq_swap_out" : 0,
		"refPhaseDelay" : 6,
		"refPhaseDelayFine" : 19,
		"trigRstDly" : 15, # 0xF
		"feedbackEnable": 1,
		"feedbackGain" : 2048,
		"feedbackPolarity" : 1,
		"feedbackLimitkHz": 225,
		"lmsGain": 1,
		"att_uc": 24,
		"att_dc": 0,
		"amplitude_scale": 12
	},

	"band_2" : {
		"iq_swap_in" : 0,
		"iq_swap_out" : 0,
		"refPhaseDelay" : 6,
		"refPhaseDelayFine" : 19,
		"trigRstDly" : 15, # 0xF
		"feedbackEnable": 1,
		"feedbackGain" : 2048,
		"feedbackPolarity" : 1,
		"feedbackLimitkHz": 225,
		"lmsGain": 1,
		"att_uc": 24,
		"att_dc": 0,
		"amplitude_scale": 12
	},

	"band_3" : {
		"iq_swap_in" : 0,
		"iq_swap_out" : 0,
		"refPhaseDelay" : 6,
		"refPhaseDelayFine" : 16,
		"trigRstDly" : 15, # 0xF
		"feedbackEnable": 1,
		"feedbackGain" : 2048,
		"feedbackPolarity" : 1,
		"feedbackLimitkHz": 225,
		"lmsGain": 1,
		"att_uc": 24,
		"att_dc": 0,
		"amplitude_scale": 12
	}
},

"bad_mask" : {
},

"amplifier" : {
	     # Updated 8/9/21, gives roughly Id=4mA
	     "hemt_Vg" : 0.265,
	     "bit_to_V_hemt" : 1.93e-06,
	      # C05-40, measured with drain set to 0.5V but output open
	     "hemt_Id_offset" : 0.2326,
	     "LNA_Vg" : 0,
	      # C05-40, measured with drain set to 5.0V but output open	     
	     "50k_Id_offset" : 0.5084,
	     "dac_num_50k" : 32,
	     "bit_to_V_50k" : 3.38e-06,
	     "hemt_gate_min_voltage" : -1.0,
	     "hemt_gate_max_voltage" :  1.0,
	     "hemt1" : {
		     "drain_conversion_b": 1.74185,
		     "drain_conversion_m": -0.259491,
		     "drain_dac_num": 31,
		     # C05-40, measured with drain set to 0.5V but output open
		     "drain_offset": 0.2326,
		     "drain_opamp_gain": 3.874,
		     "drain_pic_address": 3,
		     "drain_resistor": 50.0,
		     "drain_volt_default": 0.5,
		     "drain_volt_min": 0,
		     "drain_volt_max": 2,
		     "gate_bit_to_volt": 3.86936e-6,
		     "gate_volt_default": 0.265,
		     "gate_volt_min": 0,
		     "gate_volt_max": 2.03,
		     "power_bitmask": 1
		     },

             "hemt2":{
	      	     "drain_conversion_m":-0.259491,
              	     "drain_conversion_b":1.74185,
              	     "drain_dac_num":29,
		     # C05-40, measured with drain set to 0.5V but output open		     
              	     "drain_offset":0.2881,
              	     "drain_opamp_gain":3.874,
              	     "drain_pic_address":10,
              	     "drain_resistor":50.0,
              	     "drain_volt_default":0.5,
              	     "drain_volt_max":2,
              	     "drain_volt_min":0,
              	     "gate_bit_to_volt":3.86936e-6,
              	     "gate_dac_num":27,
              	     "gate_volt_default":0.0,
              	     "gate_volt_max":2.03,
              	     "gate_volt_min":0,
              	     "power_bitmask":4
              },

             "50k1" : {
               "drain_conversion_m": -0.224968,
               "drain_conversion_b": 5.59815,
               "drain_dac_num": 32,
	       # C05-40, measured with drain set to 5.0V but output open
               "drain_offset": 0.5084,
               "drain_opamp_gain": 9.929,
               "drain_pic_address": 4,
               "drain_resistor": 12.0,
               "drain_volt_default": 5.0,
               "drain_volt_max": 5.5,
               "drain_volt_min": 3.5,
               "gate_bit_to_volt": 3.86936e-6,
               "gate_dac_num": 30,
               "gate_volt_default": 0.0,
               "gate_volt_max": 2.03,
               "gate_volt_min": 0,
               "power_bitmask": 2
	    },		

           "50k2" : {
               "drain_conversion_m": -0.224968,
               "drain_conversion_b": 5.59815,
               "drain_dac_num": 28,
	       # C05-40, measured with drain set to 5.0V but output open
               "drain_offset": 0.3599,
               "drain_opamp_gain": 9.929,
               "drain_pic_address": 11,
               "drain_resistor": 12.0,
               "drain_volt_default": 5.0,
               "drain_volt_max": 5.5,
               "drain_volt_min": 3.5,
               "gate_bit_to_volt": 3.86936e-6,
               "gate_dac_num": 26,
               "gate_volt_default": 0.0,
               "gate_volt_max": 2.03,
               "gate_volt_min": 0,
               "power_bitmask": 8
           }
},

"attenuator" : {
	"att1" : 0,
	"att2" : 1,
	"att3" : 2,
	"att4" : 3
},

"chip_to_freq" : {
	"9" :  [4.94150, 5.05],
	"10" : [5.05, 5.17550 ],
	"11" : [5.20150, 5.28250 ],
	"12" : [5.28250, 5.41050 ],
	"13" : [5.42050, 5.54550 ],
	"14" : [5.55150, 5.67650 ],
	"15" : [5.66650, 5.79150 ],
	"16" : [5.79050, 5.91550 ]
},

# Set for C05 cryostat card.
"pic_to_bias_group": {
        "0" : 0,
        "1" : 1,
        "2" : 2,
        "3" : 3,
        "4" : 4,
        "5" : 5,
        "6" : 6,
        "7" : 7,
        "8" : 8,
        "9" : 9,
        "10" : 10,
        "11" : 11
},

# Set for C02 cryostat card.  See
#https://confluence.slac.stanford.edu/display/SMuRF/Cryostat+board
"bias_group_to_pair" : {
        "0" : [1,2],
        "1" : [3,4],
        "2" : [5,6],
        "3" : [7,8],
        "4" : [9,10],
        "5" : [11,12],
        "6" : [13,14],
        "7" : [15,16],
        "8" : [17,18],
        "9" : [19,20],
        "10" : [21,22],
        "11" : [23,24]
},

"R_sh" : 390e-6,
# (2.21*3+1.40)*2 + 0.040 in kOhm
#   2.21k is low current mode resistors (x6)
#   1.40k is high current mode resistors (x2)
#   0.040k is roundtrip cryocable resistance
#   from BOM - https://confluence.slac.stanford.edu/download/attachments/326525050/ML-248-103-02-C05_Cryostat%20Board_BOM.xlsx?version=9&modificationDate=1648492034000&api=v2
"bias_line_resistance" : 16100,
"high_low_current_ratio" : 5.669,

"high_current_mode_bool": 0,

"all_bias_groups": [0],

"tune_band" : {
	"n_samples" : 262144,
	"grad_cut" : 0.05,
	"amp_cut" : 0.25,
	"freq_max" : 250000000,
	"freq_min" : -250000000,
	# For Stanford 5-6ghz 528 box in FP29, with a standard (not
	# modified for high current) RTM
	"fraction_full_scale": 0.489,
	"reset_rate_khz": 4.0,
	"delta_freq": {
		    "0" : 0.02,	
		    "1" : 0.02,
		    "2" : 0.02,
		    "3" : 0.02
        },		
	"lms_freq": {
		    "0" : 16500,	
		    "1" : 19945,
		    "2" : 19986,
		    "3" : 20218
        },
	# The fraction of each flux ramp cycle above which we start
	# applying feedback, within each cycle.  Must be >0.  If >1,
	# then You want this to be large enough to mask the transient
	# which occurs after each flux ramp reset.  Must be in [0,1).
	"feedback_start_frac" : {
		    "0" : 0.05,	
		    "1" : 0.05,
		    "2" : 0.05,
		    "3" : 0.05
	},
	# The fraction of each flux ramp cycle above which we stop
	# applying feedback, within each cycle.  Must be >0.  If >1,
	# then feedback over the entire cycle (after feedbackStart).
	"feedback_end_frac" : {
		    "0" : 0.98,
		    "1" : 0.98,		    
		    "2" : 0.98,
		    "3" : 0.98
	},
	"gradient_descent_gain": {
		    "0" : 1e-4,
		    "1" : 1e-4,		    
		    "2" : 1e-4,
		    "3" : 1e-4
        },
	"gradient_descent_averages": {
		    "0" : 1,
		    "1" : 1,		    
		    "2" : 1,
		    "3" : 1
        },
	"gradient_descent_converge_hz":{
		    "0" : 500,
		    "1" : 500,
		    "2" : 500,
		    "3" : 500
	},
	"gradient_descent_step_hz":{
		    "0" : 1000,
		    "1" : 1000,
		    "2" : 1000,
		    "3" : 1000
	},
	"gradient_descent_momentum":{
		    "0" : 1,
		    "1" : 1,
		    "2" : 1,
		    "3" : 1
	},
	"gradient_descent_beta": {
		    "0" : 0,
		    "1" : 0,
		    "2" : 0,
		    "3" : 0
	},
	"eta_scan_del_f": {
		    "0": 5000,
		    "1": 5000,
		    "2": 5000,
		    "3": 5000
	},
	"eta_scan_amplitude":{
		    "0" : 12,
		    "1" : 12,
		    "2" : 12,
		    "3" : 12
	},
	"eta_scan_averages": {
		    "0" : 1,
		    "1" : 1,		    
		    "2" : 1,
		    "3" : 1
        }
	#"default_tune": "/data/smurf_data/tune/1558666435_tune.npy"
},

"flux_ramp" : {
	"select_ramp" : 1,
	"num_flux_ramp_counter_bits" : 32
},

"constant" : {
	"pA_per_phi0" : 9e6
},

"timing" : {
	# "ext_ref" : internal oscillator locked to an external
	#   front-panel reference, or unlocked if there is no front
	#   panel reference.  (LmkReg_0x0147 : 0x1A).  Also sets
	#   flux_ramp_start_mode=0
	# "backplane" : takes timing from timing master through
	#   backplane.  Also sets flux_ramp_start_mode=1.
	"timing_reference" : "ext_ref"
},

"fs" : 200.0,

"smurf_to_mce" : {
	"smurf_to_mce_file" : "/data/smurf2mce_config/smurf2mce.cfg",
	"mask_file" : "/data/smurf2mce_config/mask.txt",
	"receiver_ip" : "tcp://192.168.3.1:3334",
	"port_number" : "3334",
	"filter_freq" : 63,
	"filter_order" : 4,
	"filter_gain" : 1.0,
	"file_name_extend" : 1,
	"data_frames" : 300000,
	"static_mask" : 0,
	"num_averages" : 20,
	# Kludge to account for offset in gcp channel number in early
	# versios of the DSPv3 fw.  May be different for each band, in
	# mitch_4_30 the offset for band 2 is -2.  Mitch plans to fix
	# in fw, so this should be unnecessary soon.
	"mask_channel_offset" : 0
},

"default_data_dir": "/data/smurf_data",
# For remote commanding
#"smurf_cmd_dir": "/data/smurf_data/smurf_cmd",
"tune_dir" : "/data/smurf_data/tune",
"status_dir" : "/data/smurf_data/status"
}
